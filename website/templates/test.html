<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="static/chosen/chosen.css" />
    <link href='http://fonts.googleapis.com/css?family=Amatic+SC:700' rel='stylesheet' type='text/css'>
    <style type="text/css">
    /*::selection { background: #906B2D; }
    ::-moz-selection { background: #906B2D; } */

    body {
      /*background: #474747 url(static/images/bg.png);*/
      background: #F3F3F3;
      color: #000000;
      font-family: Helvetica, Arial, Sans-Serif;
      border-width: 0px;
      margin: 0px;
      width: 100%;
      height: 100%;
    }

    header {
      color: #282828;
      height: 60px;
      background: url(static/images/header_background.png);
    }


    footer {
      background: #282828;
      color: #fff;
      min-width: 100%;
      min-height: 200px;
      padding: 20px 0px 0px 0px;
    }

    .clearfix:after {
      content: ".";
      display: block;
      height: 0;
      clear: both;
      visibility: hidden;
    }
    .clearfix {display: inline-block;}
    /* Hide from IE Mac \*/
    .clearfix {display: block;}
    /* End hide from IE Mac */

    a:link {text-decoration: none; color:inherit}
    a:visited {text-decoration: none; color:inherit}
    a:hover {text-decoration: underline; color:inherit}
    a:active {text-decoration: underline; color:inherit}

    .screen_nameLink a:hover {text-decoration: none;}

    .boxShadow {
      -moz-box-shadow: 0px 0px 15px #8B8B8B;
      -webkit-box-shadow: 0px 0px 15px #8B8B8B;
      box-shadow: 0px 0px 15px #8B8B8B;
    }

    .centered-content {
      max-width: 800px;
      margin: auto;
      padding: 0;
      padding-top: 20px;
    }

    .centered-header {
      max-width: 800px;
      margin: auto;
    }

    .logo-header {
      font-family: 'Amatic SC', cursive;
      font-size: 40px;
      padding-top: 10px;
    }

    #tweetMeta {
      height: 80px;
      background: #282828;
      color: #FFFFFF;
      padding-top: 10px;
      padding-left: 10px;
      position: relative;
    }

    #Sentimos {
      outline: 0;
      background: #282828;
      height: 460px;
      width: 800px;
      margin-left: auto;
      margin-right: auto;
    }

    #feelings {
      margin-top: 20px;
    }

    #tweetsText {
      margin-top: 20px;
    }

    .search-feelings-div {
      color: #000;;
    }

    /*.chzn-container-multi .chzn-choices {
      background-image: none;
      background: #1A1711;
      height: 50px !important;
      color: #F6E6CC;
    }

    .chzn-container .chzn-drop {
      background-color: #1A1711;
    }*/

    </style>
    <title>Como nos Sentimos</title>
  </head>
  <body>
    <header class="boxShadow">
      <div class="centered-header">
        <div class="logo-header">
          Como nos Sentimos
        </div>
      </div>
    </header>
    <!-- <div style="height: 30px"></div> -->
    <div class="centered-content">
      <div id="tweet">
        <div id="tweetMeta" class="boxShadow">
          Clique em uma partícula
        </div>
      </div>
      <div style="height: 10px"></div>
      <div id="pjsdiv">
        <canvas id="Sentimos" class="boxShadow" data-processing-sources="processing/Sentimos/Sentimos.pde processing/Sentimos/Particle.pde processing/Sentimos/Tweet.pde processing/Sentimos/IO.pde processing/Sentimos/Attribute.pde processing/Sentimos/Feeling.pde processing/Sentimos/Weather.pde processing/Sentimos/State.pde processing/Sentimos/General.pde"></canvas>
      </div>

      <div class="clearfix">
        <br>
        <div style="float: left;">
          <button onclick="setMadnessView()">Madness</button>
          <button onclick="setFeelingsView()">Feelings</button>
          <button onclick="setStatesView()">States</button>
          <button onclick="setMapView()">Map</button>
        </div>
        <div style="float: right; font-size: 11px;">
          Hash da visualização: {{ data_md5 }}
        </div>
        <br> <br>
      </div>

      <!-- If JSON was used -->
      <div id="fromProcessing">
        <script type="text/javascript">
          // var my_json;
          // $.getJSON("http://cns.com/read_api/api/v1/tweets/", function(json) {
          //   my_json = json;
          //   for (var i in my_json.tweets) {
          //     $("#fromProcessing").append(my_json.tweets[i].text + "<br>");
          //   }
          // });
        </script>
      </div>

      <div class="search-feelings-div">
        <form action="{{url_for('hello')}}" method="get" style="float: left;">
          <select name="selected-feelings" data-placeholder="Escolha sentimentos..." class="chzn-select" multiple style="width:350px;" tabindex="4">
            {% for feeling in feelings %}
              <option value="{{ feeling[0] }}">{{ feeling[0] }}</option>;
            {% endfor %}
          </select>
          <div>
            <input type="submit" value="Carregar">
          </div>
        </form>
        <form action="{{url_for('hello')}}" method="get" style="float: right;">
          <select name="selected-states" data-placeholder="Escolha estados..." class="chzn-select" multiple style="width:350px;" tabindex="4">
            {% for state in states_unique %}
              <option value="{{ state[0] }}">{{ state[1] }}</option>;
            {% endfor %}
          </select>
          <div>
            <input type="submit" value="Carregar" style="float: right;">
          </div>
        </form>
      </div>

      <div style="height: 300px;"></div>

    </div>

    <footer class="boxShadow">
      <div class="centered-content">
        Como nos Sentimos - Artur Rodrigues
      </div>
    </footer>

    <!-- HTML to Processing -->
    <script type="text/javascript">
      function loadTweets() {
        var pjs = Processing.instances[0];
        {% for tweet in tweets %}
          var author = new pjs.Author();
          author.screen_name = "{{ tweet.author.screen_name }}";
          {% if tweet.author.name %}
            author.name = "{{ tweet.author.name }}";
          {% endif %}

          {% if tweet.author.location %}
            author.location = "{{ tweet.author.location }}";
          {% endif %}

          var location = undefined;
          {% if tweet.location %}
            var tempLocation = new pjs.Location();
            tempLocation.state = "{{ tweet.location.state }}";
            {% if tweet.location.city %}
              tempLocation.city = "{{ tweet.location.city }}";
            {% endif %}
            {% if tweet.location.weather %}
              tempLocation.weather = "{{ tweet.location.weather }}"
            {% endif %}
            location = tempLocation;
          {% endif %}

          var pTweet = new pjs.Tweet();
          pTweet.id = "{{ tweet.id }}";
          pTweet.textString = "{{ tweet.text }}";
          pTweet.feelings = [];
          pTweet.created_at = "às " + "{{ tweet.created_at.strftime('%H:%M do dia %d/%m') }}";
          pTweet.created_at_bsb = "às " + "{{ tweet.created_at_bsb.strftime('%H:%M do dia %d/%m') }}";
          pTweet.created_at_local = "às " + "{{ tweet.created_at_local.strftime('%H:%M do dia %d/%m') }}";
          {% for feeling in tweet.feelings %}
            pTweet.feelings.push("{{ feeling }}");
          {% endfor %}
          pTweet.author = author;
          if(location != undefined)
            pTweet.location = location;
          pjs.addTweet(pTweet);
        {% endfor %}
      }

      function loadFeelings() {
        {% for feeling in feelings %}
          var textString = "{{ feeling[0] }}";
          var frgb = "{{ feeling[1] }}";
          frgb = frgb.split(',');
          for (var i = frgb.length - 1; i >= 0; i--) {
            frgb[i] = parseInt(frgb[i]);
          }
          var pFeeling = new pjs.Feeling(textString, frgb);
          pjs.addFeeling(pFeeling);
        {% endfor %}
      }

      function loadWeatherTranslations() {
        {% for translation in weather_translations %}
          var condition = "{{ translation[0] }}";
          var translation = "{{ translation[1] }}";
          var pWeather = new pjs.Weather(condition, translation);
          pjs.addWeather(pWeather);
        {% endfor %}
      }

      function loadStates() {
        {% for state in states %}
          var textString = "{{ state[1] }}";
          var abbreviation = "{{ state[0] }}";
          var srgb = "{{ state[2] }}";
          srgb = srgb.split(',');
          for (var i = srgb.length - 1; i >= 0; i--) {
            srgb[i] = parseInt(srgb[i]);
          }
          var pState = new pjs.State(textString, abbreviation, srgb);
          pjs.addState(pState);
        {% endfor %}
      }

      function setFeelingsView() {
        pjs.setFeelingsView();
      }

      function setMadnessView() {
        pjs.setMadnessView();
      }

      function setStatesView() {
        pjs.setStatesView();
      }

      function setMapView() {
        pjs.setMapView();
      }

      function pjsPostInitialLoading() {
        pjs.postInitialLoading();
        pjs.mouseOut();
      }

      function pjsPostImagesLoading() {
        pjsLoadQuestionMarkPixels();
        pjsLoadCountryMapPixels();
        pjsSetParticlesLocs();
      }

      function pjsLoadQuestionMarkPixels() {
        var pjsQuestionMarkImageWidth = pjs.getQuestionMarkImageWidth();
        if(pjsQuestionMarkImageWidth == 0) {
          setTimeout(pjsLoadQuestionMarkPixels, 400);
        } else {
          pjs.loadQuestionMarkPixels();
        }
      }

      function pjsLoadCountryMapPixels() {
        var pjsCountryMapImageWidth = pjs.getCountryMapImageWidth();
        if(pjsCountryMapImageWidth == 0) {
          setTimeout(pjsLoadCountryMapPixels, 400);
        } else {
          var stateListSize = pjs.getStateListSize();
          for (var i=0; i<stateListSize; i++) {
            setTimeout((function(x) {
              return function() {
                countryStatesLoaded += pjs.loadCountryMapPixels(x);
              }
            })(i), 0);
          }
        }
      }

      function pjsSetParticlesLocs() {
        var stateListSize = pjs.getStateListSize();
        if(countryStatesLoaded != stateListSize) {
          setTimeout(pjsSetParticlesLocs, 400);
        } else {
          pjs.setParticlesLocs();
        }
      }
    </script>

    <!-- Processing to HTML -->
    <script type="text/javascript">
      function setTweetMeta(id, textString, name, screen_name, location, created_at_bsb) {
        var html_str = '<span style="font-weight: bolder;">' +
          '<a target="_blank" href="http://twitter.com/' + screen_name + '">' + name + '</a> - ' +
          '</span>' +
          '<span class="screen_nameLink" style="font-size: 12px; color: inherit;">' +
          '<a target="_blank" href="http://twitter.com/' + screen_name + '">@' + screen_name + '</a>' +
          '</span>' +
          '<p style="margin: 2px; font-size: 13px;">' +
          textString +
          '</p>' +
          '<span style="font-size: 11px; position: absolute; bottom: 5px;">' +
          '<span class="screen_nameLink">' +
          '<a target="_blank" href="http://twitter.com/' + screen_name + '/status/' + id + '">' +
          created_at_bsb +
          ', de ' +
          location +
          '</a>' +
          '</span> - ' +
          '<a target="_blank" href="http://twitter.com/' + screen_name + '/status/' + id + '">' +
          'veja no twitter' +
          '</a>'
          '</span>'
        $("#tweetMeta").html(html_str);
      }
    </script>

    <!-- Processing.js essentials -->
    <script type="text/javascript">
      // GLOBAL variables
      var pjs = undefined;
      var countryStatesLoaded = 0;
      window.onload = function() {
        makeTheLink();
      }

      // initialLoad is used to load initial functions
      function initialLoad() {
        if(pjs == undefined) {
          setTimeout(initialLoad, 400);
        } else {
          loadFeelings();
          loadWeatherTranslations();
          loadStates();
          loadTweets();
          pjsPostInitialLoading();
          pjsPostImagesLoading();
        }
      }

      function makeTheLink() {
        pjs = Processing.instances[0];
        if(pjs == undefined) {
          setTimeout(makeTheLink, 600);
        } else {
          // Processing.logger = console;
          // pjs.setInterfaceLink(this);
          // initialLoad();
          try {
            // Comment the line below to make it work on IE9
            Processing.logger = console;
            pjs.setInterfaceLink(this);
            initialLoad()
          } catch(e) {
            setTimeout(makeTheLink, 200);
          }
        }
      }
    </script>
    <!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="static/js/jquery-1.7.2.min.js"><\/script>')</script> -->
    <script src="static/js/jquery-1.7.2.min.js" type="text/javascript"></script>
    <script src="static/js/processing-1.3.6.min.js" type="text/javascript"></script>
    <script src="static/chosen/chosen.jquery.min.js" type="text/javascript"></script>
    <script type="text/javascript">
      $(".chzn-select").chosen();
      $(".chzn-select-deselect").chosen({allow_single_deselect:true});
    </script>
  </body>
</html>
